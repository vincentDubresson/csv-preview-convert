<div class="csv-preview-convert-popup-content-container">
    {% if canGeneratePreview is not defined or canGeneratePreview is same as false %}
    <div class="csv-preview-form-container">
        {{ form_start(form, {
            'attr': {'class': 'csv-preview-import-form', 'novalidate': 'novalidate'},
            'action': path('csv_preview_submit')
        }) }}

        <div class="form-group">
            {{ form_label(form.file, 'S√©lectionnez votre fichier CSV', {'label_attr': {'class': 'form-label'}}) }}
            <div class="custom-file-upload">
                {{ form_widget(form.file, {'attr': {'class': 'form-input-hidden'}}) }}
                <button type="button" class="btn-browse">Parcourir</button>
                <span class="file-name">Aucun fichier s√©lectionn√©</span>
            </div>
            <small class="form-hint">Formats autoris√©s : .csv (max 10 Mo)</small>
            <div class="form-error">
                {{ form_errors(form) }}
                {{ form_errors(form.file) }}
            </div>
        </div>

        <button type="submit" class="btn-submit">‚¨Ü Importer & Pr√©visualiser</button>

        {{ form_end(form) }}
    </div>
    {% endif %}

    {% if canGeneratePreview is defined and canGeneratePreview is same as true %}
        <div class="csv-preview-container">

            <div class="csv-encoding-advice">
                <strong>üí° Conseils sur l‚Äôencodage :</strong>
                <p>Plusieurs encodages peuvent sembler corrects dans l‚Äôaper√ßu, car votre navigateur peut corriger certains caract√®res automatiquement.</p>
                <p>Nous vous recommandons de tester les encodages suivants dans cet ordre :</p>
                <ol>
                    <li>1. UTF-8 (plus compatible et moderne)</li>
                    <li>2. Windows-1252 (standard Excel Windows)</li>
                    <li>3. ISO-8859-15 (inclut ‚Ç¨ et certains caract√®res europ√©ens)</li>
                    <li>4. ISO-8859-1 (moins s√ªr pour certains caract√®res sp√©ciaux et de potentielles corrections automatiques du navigateur)</li>
                </ol>
                <p>D√®s qu‚Äôun encodage affiche correctement tous les caract√®res sp√©ciaux, vous pouvez vous arr√™ter et ne pas tester les suivants.</p>
                <p><strong>‚ö† Attention :</strong> si aucun encodage n‚Äôaffiche correctement les caract√®res sp√©ciaux, vous devrez convertir votre fichier CSV avec un outil externe avant de l‚Äôimporter. Cela peut √™tre fait via un √©diteur de texte ou un logiciel de conversion d‚Äôencodage.</p>
            </div>

            <form action="{{ path('csv_preview_convert_and_download') }}" class="csv-preview-export-form" method="POST" target="_blank">
                <div class="csv-preview-toolbar">
                    <label for="encoding">Encodage d'entr√©e :</label>
                    <select id="encoding" name="encoding" class="encoding-select">
                        {% for case in encodings %}
                            <option value="{{ case.value }}" {% if case.value is same as selectedEncoding %}selected{% endif %}>{{ case.label() }}</option>
                        {% endfor %}
                    </select>
                </div>

                <iframe
                        src="{{ path('csv_preview_content', {'encoding': selectedEncoding}) }}"
                        style="width:100%; height:250px;">
                </iframe>

                <div class="csv-convert-action">
                    <div class="csv-output-encoding">
                        <label for="output_encoding">Encodage de sortie :</label>
                        <select id="output_encoding" name="output_encoding" class="encoding-select">
                            {% for case in encodings %}
                                <option value="{{ case.value }}">{{ case.label() }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <p>
                        Une fois que vous avez choisi l‚Äôencodage de sortie souhait√© pour votre fichier CSV, cliquez sur le bouton ci-dessous
                        pour <strong>convertir et t√©l√©charger le fichier</strong> avec cet encodage.
                    </p>
                    <input type="hidden" name="_token" value="{{ csrf_token('csv-convert-download') }}">

                    <button type="submit" class="csv-preview-convert-convert-btn">Convertir et t√©l√©charger le fichier</button>
                    <p class="csv-convert-download-error"></p>
                </div>
            </form>

        </div>
    {% endif %}

    <button class="csv-preview-convert-btn-gray" id="csv-preview-convert-close-popup">Fermer</button>
</div>
